# Forgejo - установка, настройка, использование
## Переход на VM и клонирование forgejo
```bash
docker pull codeberg.org/forgejo/forgejo:11
```

### Теперь нужно запустить контейнер и настроить для Git.

* **1. Запустить контейнер Forgejo, указав порты, тома (volumes) для сохранения данных и другие настройки.**
* **2. Настроить Forgejo через веб-интерфейс (создать пользователя, репозиторий и т.д.)**
* **3. С хостовой машины клонировать репозиторий, вносить изменения и пушить.**

#### Порядок:

* **1. Запуск контейнера Forgejo**

Для запуска контейнера команда `docker run`. Необходимо:

- Создать том для данных (или использовать bind mount), чтобы данные сохранялись после остановки контейнера.

- Пробросить порт (обычно 3000 в контейнере на порт хоста, например, 8080).

Пример команды:

```bash

docker run -d \

--name forgejo \

-p 8080:3000 \

-p 2222:22 \

-v /путь/на/хосте/forgedata:/data \

codeberg.org/forgejo/forgejo:11

```

Пояснение:

- `-d` - запуск в фоновом режиме.

- `--name forgejo` - имя контейнера.

- `-p 8080:3000` - проброс порта: хост 8080 -> контейнер 3000 (веб-интерфейс).

- `-p 2222:22` - проброс порта для SSH (если планируете использовать SSH для Git).

- `-v ...` - том для данных. Замените `/путь/на/хосте/forgedata` на реальный путь на хосте.

После запуска откройте в браузере: `http://<IP_вашей_VM>:8080`

2. Начальная настройка Forgejo

При первом заходе в веб-интерфейс потребуется:

- Настроить базу данных: если мы используем том, то Forgejo использует встроенную SQLite по умолчанию (это нормально для небольших инсталляций).

- Настроить параметры сервера:

- Домен: укажите IP вашей VM или доменное имя, если есть.

- Порт SSH: 2222 (если пробрасывали порт 2222 на хосте).

- Создать первого пользователя (администратора). Например, пользователь `starter` (или другой).

- После этого войти под этим пользователем.

Затем:

- Создать репозиторий (кнопка "+" в верхнем правом углу).

- Дать имя репозиторию, например, `myproject`.

3. Работа с Git с хостовой машины

Теперь с вашей хостовой машины (не VM) можно клонировать репозиторий, работать с ним и пушить изменения.

Варианты доступа:

- По HTTP: `http://<IP_вашей_VM>:8080/starter/myproject.git`

- По SSH: `ssh://git@<IP_вашей_VM>:2222/starter/myproject.git`

Примечание: для SSH нужно добавить публичный ключ в настройках вашего пользователя в Forgejo (в профиле пользователя -> Настройки -> SSH ключи).

Пример клонирования по HTTP (если не настраивали SSH):

```bash

git clone http://<IP_вашей_VM>:8080/starter/myproject.git

```

Затем:

- Перейдите в папку проекта: `cd myproject`

- Создайте файлы, внесите изменения.

- Добавьте изменения: `git add .`

- Сделайте коммит: `git commit -m "Initial commit"`

- Отправьте на сервер: `git push origin master` (или main, в зависимости от имени ветки)

При первом пуше по HTTP запросит логин и пароль (логин - ваш пользователь в Forgejo, пароль - тот, что задали при регистрации).

Если хотите использовать SSH, то:

- Сгенерируйте SSH ключ на хосте (если нет) командой `ssh-keygen`.

- Скопируйте содержимое публичного ключа (обычно `~/.ssh/id_rsa.pub`) и вставьте в настройках SSH ключей в Forgejo.

- Клонируйте репозиторий по SSH:

```bash

git clone ssh://git@<IP_вашей_VM>:2222/starter/myproject.git

```

Порт 2222 указан, потому что мы пробросили порт 22 контейнера на порт 2222 хоста.

4. Дополнительно: настройка SMTP (если нужно отправлять уведомления)

Если требуется, можно настроить отправку почты. Для этого при начальной настройке Forgejo (или позже в настройках администратора) укажите параметры SMTP.

Важно: если ваша VM находится за NAT или в облаке, убедитесь, что порты (8080 и 2222) открыты в фаерволе VM и, возможно, на хост-машине (если это виртуалка на вашем компьютере, то обычно проблем нет).

Таким образом, после запуска контейнера и настройки Forgejo вы сможете работать с Git репозиториями так же, как с GitHub, но на своем сервере.

## Установили Forgejo! -> пошаговая инструкция настройки:
### 1. Запуск Forgejo в Docker
* **Создайте docker-compose.yml (рекомендуется) или запустите контейнер вручную:**
```yaml
version: '3'

services:
  forgejo:
    image: codeberg.org/forgejo/forgejo:11
    container_name: forgejo
    environment:
      - USER_UID=1000
      - USER_GID=1000
    volumes:
      - ./forgejo_data:/data
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro
    ports:
      - "3000:3000"   # Веб-интерфейс
      - "2222:22"     # SSH для Git
    restart: unless-stopped
```
* **Запустите:**
```bash
docker-compose up -d
```

### 2. Начальная настройка через веб-интерфейс

    Откройте в браузере: http://<IP_вашей_VM>:3000

    Пройдите начальную настройку:

        База данных: Выберите SQLite (достаточно для начала)

        Общие настройки:

            Имя сервера: http://<IP_вашей_VM>:3000

            Порт SSH: 2222

        Администратор:

            Логин: starter

            Email: ваш email

            Пароль: задайте надежный

### 3. Настройка репозитория

    После входа нажмите "+" в верхнем правом углу → "Новый репозиторий"

    Заполните:

        Имя репозитория: например myproject

        Видимость: Приватный/Публичный

        Инициализировать репозиторий: ✔️

        Добавить .gitignore: Optional

    Нажмите "Создать репозиторий"

### 4. Настройка SSH (рекомендуется)

    На хостовой машине сгенерируйте SSH-ключ:
    bash

    ssh-keygen -t ed25519 -C "starter@srvGit"

    Скопируйте публичный ключ (cat ~/.ssh/id_ed25519.pub)

    В Forgejo:

        Профиль → Настройки → SSH-ключи → "Добавить ключ"

        Вставьте содержимое

### 5. Работа с Git с вашей машины
* **Клонирование репозитория (через SSH):**
```bash
git clone ssh://git@<IP_вашей_VM>:2222/starter/myproject.git
```
* **Или через HTTP:**
```bash
git clone http://<IP_вашей_VM>:3000/starter/myproject.git
```

* **Первый коммит:**
```bash
cd myproject
echo "# My Project" >> README.md
git add .
git commit -m "Initial commit"
git push origin main
```

### 6. Порт-форвардинг для доступа снаружи
* **Если VM локальная, пробросьте порты на хост:**
```bash
ssh -L 3000:localhost:3000 -L 2222:localhost:2222 starter@srvGit
```
* **Теперь доступно:**

    Веб: **http://localhost:3000**

    Git SSH: git clone ssh://git@localhost:2222/...

### 7. Важные моменты
* **Безопасность:**
  * Смените порты в docker-compose.yml при работе в интернете
  * Используйте reverse-proxy (Nginx) с HTTPS

* **Резервное копирование:**
```bash
docker exec forgejo forgejo dump -c /data/forgejo/conf/app.ini
```
  * Резервная копия появится в ./forgejo_data

* **Обновление:**
```bash

    docker-compose pull
    docker-compose up -d
```

* **Если возникнут проблемы с подключением:**

    Проверьте статус контейнера: docker logs forgejo

    Убедитесь что порты открыты: ss -tuln | grep '3000\|2222'

    Проверьте права на томы: chmod -R 777 ./forgejo_data (временно для диагностики)

### Для миграции с GitHub используйте встроенные инструменты миграции в Forgejo.